version: '3.8'

services:
  wedding-site:
    build: ./site
    container_name: wedding-site
    ports:
      - "8080:5000"
    volumes:
      - ./site/materials:/app/materials
      - ./site/src/static/images:/app/src/static/images
    environment:
      - FLASK_ENV=production
    restart: unless-stopped

  wedding-bot:
    build: ./tg_bot
    container_name: wedding-bot
    volumes:
      - ./tg_bot/data:/app/data
      - ./tg_bot/logs:/app/logs
    env_file:
      - ./tg_bot/.env
    environment:
      - SITE_API_URL=http://wedding-site:5000
    depends_on:
      - wedding-site
    restart: unless-stopped

  # For development with hot reload
  wedding-site-dev:
    build: ./site
    container_name: wedding-site-dev
    ports:
      - "5001:5000"
    volumes:
      - ./site:/app
    environment:
      - FLASK_ENV=development
      - FLASK_DEBUG=1
    command: python src/app.py
    profiles:
      - dev
